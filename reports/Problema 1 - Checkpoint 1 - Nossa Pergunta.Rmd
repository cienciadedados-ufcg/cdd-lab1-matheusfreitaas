---
title: "Problema 1 - Checkpoint 1 - Nossa Pergunta"
author: "Matheus Freitas"
date: "23 de abril de 2018"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
  html_notebook:
    toc: yes
    toc_float: yes
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(here)
library(raster)
theme_set(theme_bw())
```

# Panorama Geral

```{r}
data_all <- read_csv(here("data/series_from_imdb.csv"), 
                    progress = FALSE,
                    col_types = cols(.default = col_double(), 
                                     series_name = col_character(), 
                                     episode = col_character(), 
                                     url = col_character(),
                                     season = col_character()))

n_series <- data_all %>% 
    group_by(series_name) %>%
    summarise(n()) %>%
    nrow()
```
Nesta análise usaremos os dados coletados do [IMDB](http://www.imbd.com/). Ao todo temos a avaliação de `r data_all %>% nrow()` episódios de `r n_series` séries diferentes mas aqui usaremos um subconjunto composto pelas séries **Vikings** e **Game of Thrones**, considerando as quatro primeiras temporadas das duas séries.

```{r}
data <- data_all %>%
    filter(series_name %in% c("Vikings", "Game of Thrones")) %>%
    filter(season %in% 1:4)
```

O gráfico abaixo compara o número de votos por episódio de cada temporada.

```{r}
data %>% 
    ggplot(mapping = aes(x = season_ep, 
               y = user_votes,
               color = series_name)) + 
    geom_line() + 
    geom_point() +
    facet_wrap(~ season, scales = "free_x") +
    labs(x = "Episodios", 
         y = "Quantidade de votos", 
         color = "Séries")

media_votos <- data %>%
    group_by(series_name) %>%
    summarise(media = mean(user_votes))

proporcao_medias <- media_votos$media[1] / media_votos$media[2]
```
Aqui percebemos a diferença na quantidade de usuários que votaram em cada uma das séries a cada temporada. Considerando todos os espisódio que estamos analisando o número médio de usuários que avaliam os episódios de Game of Thrones é `r round(proporcao_medias, 2)` maior que o dos que avaliam Vikings, o que deixa claro que GoT possui mais expectadores que utilizam o IMDB, dessa forma as análises a seguir vão buscar levar isso em conta.

# Quem é melhor avaliada?

```{r}
data %>%
  ggplot(mapping = aes(x = series_name, 
                       y = user_rating,
                       color = series_name)) +
    geom_boxplot() +
    geom_jitter(alpha = 0.5) +
    theme(legend.position="none") +
    labs(x = "Série",
         y = "Nota do episódio")

mediana_notas <- data %>%
    group_by(series_name) %>%
    summarise(media = median(user_rating))

```
O boxplot acima podemos verificar que Game of Thrones é melhor avaliada que Vikings, podemos observar isto através da mediana da avaliação de cada uma das séries que para GoT é de `r mediana_notas$media[1]` e para Vikings é `r mediana_notas$media[2]`.

Nos gráficos abaixo podemos verificar qual das séries é mais bem avaliada a cada temporada.
```{r}
data %>%
  ggplot(mapping = aes(x = season_ep, 
                       y = user_rating, 
                       color = series_name)) +
  geom_line() +
  geom_point() +
  facet_wrap(~season) +
  labs(x = "Episódio",
       y = "Nota do Episódio",
       color = "Séries" )
```
Assim ao observarmos que **Game of Thrones** possui quase que sua totalidade de pontos acima dos pontos da série **Vikings**, ou seja, os episódios da primeira são mais bem avaliados do que os episódios da segunda, respectivamente. 

>> O parágrafo abaixo precisa ser revisado, já que os valores do desvio padrão mostram o contrário.

Ao compararmos os gráficos acima, podemos notar que embora tenha uma quantidade quase que igual de votos em cada um dos episódios, a série "Vikings", possui uma discrepância relativamente grande nas notas dos seus episódios. Contudo, "Game of Thrones" possui notas mais estáveis, os pontos que se destacam por serem muito diferentes dos demais podem ser justificados pelo aumento da quantidade de votos nesses mesmos episódios.

Contudo, essa não é uma análise precisa. Para tal observemos os valores do *Desvio padrão* da avaliação de cada série na tabela abaixo:

```{r}
vikingsUserRating = filter(data, series_name == "Vikings")$user_rating
gotUserRating = filter(data, series_name == "Game of Thrones")$user_rating

data %>%
  summarise(Vikings = round(sd(vikingsUserRating), 2),
            GoT = round(sd(gotUserRating),2)) %>%
    knitr::kable()
```

O **Desvio Padrão**: É um parâmetro estatístico que indica o grau de variação de um conjunto de elementos. No nosso caso, quanto mais dispersas forem as notas, maior o desvio padrão.

Analisando esses desvios padrões relativos aos votos dos usuários para cada uma das séries, podemos chegar a conclusão que, devido ao desvio da série "Game of Thrones" ser maior, as notas dos seus episódios são as que mais variam.


# Existe, em cada uma das séries, um episódio que possui, a cada temporada, mais avaliações que os demais? Ex: toda temporada o ep 9 possui mais avaliações.

Para a primeira pergunta podemos observar os seguintes gráficos, que já foram mostrados no começo desse documento:

>> Quando optar por reutilizar um gráfico que já foi mostrado antes é melhor guardar ele em uma variável e chamar essa variável onde você deseja plotar; Evita código repetido.

```{r}
data %>%
  ggplot(mapping = aes(x = season_ep,
                       y = user_votes,
                       color = series_name)) +
  geom_point() +
  geom_line() + 
  facet_wrap(~season) +
  labs(x = "Episódio da temporada",
       y = "Número de Avaliações",
       colour = "Série")
```

Para a série "Game of Thrones" podemos notar que da primeira até a terceira temporada, o episódio mais votado é o nono, esse padrão é quebrado na quarta temporada na qual os epis?dios mais votados são os 2º, 6º e 8º. No caso da série "Vikings", não percebemos nenhum tipo de padrão, a quantidade de votos em si segue uma linearidade, quase que, do começo ao fim. 

# Inícios e finais de temporadas são mais amados ou mais odiados?

Para a segunda pergunta, podemos observar os seguintes gráficos, já mostrados no começo do documento (segundo conjunto de gráficos):

```{r}
data %>%
  ggplot(mapping = aes(x = season_ep, 
                       y = user_rating, 
                       color = series_name)) +
  geom_line() +
  geom_point() +
  facet_wrap(~season) +
  labs(x = "Episódio",
       y = "Nota do Episódio",
       color = "Séries" )
```
Podemos observar que em "Game of Thrones", existe uma tendência que o final da temporada, mais precisamente o episódio nove, seja mais bem avaliado que os demais episódios, ou seja, mais amado. No caso de "Vikings", podemos dizer que os primeiros episódios estão na média ou acima dos mais amados e os finais também estão geralmente associados a boas avaliações. 